# 谜题 29：循环者的新娘

## 背景

NaN。

## 代码

请提供一个对 i 的声明，将下面的循环转变为一个无限循环：  

```java
while (i != i) {
} 
```

## 陷阱

不管 i 在它前面作何种声明，它看起来确实应该立即终止。一个数字总是等于它自己，对吗？ 

## 解惑

浮点算术保留了一个特殊的值用来表示一个不是数字的数量，这个值就是 NaN（“不是一个数字（Not a Number）”的缩写）。对于所有没有良好的数字定义的浮点计算，例如 0.0/0.0，其值都是NaN。

**NaN 不等于任何浮点数值，包括它自身在内**。因此，如果 i 在循环开始之前被初始化为 NaN，那么终止条件测试(i != i)的计算结果就是 true，循环就永远不会终止。

## 解决办法或规则

可以用任何计算结果为 NaN 的浮点算术表达式来初始化 i，例如： 

```java
double i = 0.0 / 0.0; 
```

为了表达清晰，可以使用标准类库提供的常量： 

```java
double i = Double.NaN; 
```

**规则**：**任何浮点操作，只要它的一个或多个操作数为 NaN， 那么其结果为 NaN**。

例如， 下面的程序将打印 false： 

```java
class Test { 
    public static void main(String[] args) { 
        double i = 0.0 / 0.0; 
        System.out.println(i - i == 0); 
    } 
} 
```

计算 NaN 的规则所基于的原理是：一旦一个计算产生了 NaN，它就被损坏了， 没有任何更进一步的计算可以修复这样的损坏。NaN 值意图使受损的计算继续执行下去，直到方便处理这种情况的地方为止。 

总之，float 和 double 类型都有一个特殊的 NaN 值，用来表示不是数字的数量。