# 谜题 28：循环者

## 背景

浮点数操作、无穷大。

## 代码

通过利用在谜题 26 中所展示的溢出行为， 可以使下面的程序无限循环下去。

```java
int start = Integer.MAX_VALUE - 1; 
for (int i = start; i <= start + 1; i++) {
} 
```

什么样的声明能够让下面的循环变成一个无限循环？ 

```java
while (i == i + 1) {
} 
```

## 陷阱

仔细查看这个 while 循环，它真的好像应该立即终止。一个数字永远不会等于它 自己加 1，对吗？

## 解惑

Java可以让你用一个 double 或 float 来表示无穷大，无穷大加 1 还是无穷大。如果 i 在循环开始之前被初始化为无穷大，那么终止条件测试(i == i + 1)就会被计算 为 true，从而使循环永远都不会终止。 

## 规则或告警

可以用任何被计算为无穷大的浮点算术表达式来初始化 i，例如： 

```java
double i = 1.0 / 0.0;
```

最好利用标准类库提供的常量： 

```java
double i = Double.POSITIVE_INFINITY;
```

任何足够大的浮点数都可以实现，例如： 

```java
double i = 1.0e40; 
```

浮点数操作返回的是最接近其精确的数学结果的浮点数值。一旦毗邻的浮点数值之间的距离大于 2，那么对其中的一个浮点数值加 1 将不会产生任何效果，因为其结果没有达到两个数值之间的一半。

毗邻的浮点数值之间的距离被称为一个 ulp，它是“最小单位（unit in the last place）”的首字母缩写词。在 5.0 版中，引入了 Math.ulp 方法来计算 float 或 double 数值的 ulp。 

对于 float 类型，加 1 不会产生任何效果的最小级数是 2^25，即 33,554,432；而对于 double 类型，最小级数是 2^54，大约是 1.8 × 1016。

总之，用一个 double 或一个 float 数值来表示无穷大是可以的。大将一个很小的浮点数加到一个很大的浮点数上时， 将不会改变大的浮点数的值。