# 谜题 12：ABC  

## 背景

操作符重载、字符串连接。

## 代码

下面的程序将打印出什么呢？  

```java
public class ABC{
    public static void main(String[] args){
        String letters = "ABC";
        char[] numbers = {'1', '2', '3'};
        
        System.out.println(letters + " easy as " + numbers);
    }
}
```

## 陷阱

可能大家希望这个程序打印出 ABC easy as 123。遗憾的是，它没有。

如果你运行它，就会发现它打印的是诸如 ABC easy as [C@16f0472 之类的东西。为什么这个输出会如此丑陋？  

## 解惑

尽管 char 是一个整数类型，但是许多类库都对其进行了特殊处理，因为 char数值通常表示的是字符而不是整数。例如，将一个 char 数值传递给 println 方法会打印出一个 Unicode 字符而不是它的数字代码。

字符数组受到了相同的特殊处理：println 的 char[]重载版本会打印出数组所包含的所有字符，而String.valueOf和StringBuffer.append的 char[]重载版本的行为也是类似的。  

## 解决办法或规则

**修正**：使用一个字符串缓冲区：

```java
StringBuffer sb = new StringBuffer();
sb.append('H');
sb.append('a');

System.out.println(sb); 
```

**修正**：确保至少有一个操作数为字符串类型，来强制 + 操作符去执行一个字符串连接操作，而不是一个加法操作。这种常见的惯用法用一个空字符串（""）作为一个连接序列的开始，如下所示：  

```java
System.out.println("" + 'H' + 'a'); //这种惯用法可以确保子表达式都被转型为字符串。
```

**修正**：用 printf 方法。

```java
System.out.printf("%c%c", 'H', 'a');
```

总之，使用字符串连接操作符使用格外小心。**+ 操作符当且仅当它的操作数中至少有一个是 String 类型时，才会执行字符串连接操作**；**否则，它执行的就是加法**。

如果要连接的没有一个数值是字符串类型的，那么你可以有几种选择：

- 预置一个空字符串；
- 将第一个数值用 String.valueOf 显式地转换成一个字符串；
- 使用一个字符串缓冲区；
- 或者如果你使用的 JDK 5.0，可以用 printf 方法。  



语言设计者的教训：操作符重载，即使在 Java 中只在有限的范围内得到了支持，它仍然会引起混淆。为字符串连接而重载 + 操作符
可能就是一个已铸成的错误。  